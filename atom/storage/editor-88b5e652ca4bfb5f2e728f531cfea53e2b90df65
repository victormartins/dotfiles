{"version":1,"windowDimensions":{"x":679,"y":407,"width":1436,"height":877,"maximized":false},"grammars":{"grammarOverridesByPath":{}},"project":{"deserializer":"Project","paths":["/Users/victor.martins/Temp/sage_one_advanced"],"buffers":[{"id":"cc42eb8ce4a554c7463d4ce5e13087c8","text":"module CoreAccounting::Taxes::Models\n\n  # This class is responsible for knowing the tax rates that a combined tax is made up with\n  class TaxRateAssociation < ActiveRecord::Base\n    belongs_to :combined_tax_rate, class_name: 'CoreAccounting::Taxes::Models::TaxRate'\n    belongs_to :sub_tax_rate, class_name: 'CoreAccounting::Taxes::Models::TaxRate'\n\n    before_save :validate_sub_tax_rates\n    accepts_nested_attributes_for :sub_tax_rate\n\n    validates :sub_tax_rate_id, :uniqueness => { :scope => :combined_tax_rate_id }\n    validate :combined_and_sub_tax_equality\n\n    attr_accessible :sub_tax_rate_attributes, :name, :code, :percentage, :sub_tax_rate_id\n\n    private\n    def validate_sub_tax_rates\n      raise 'The association is missing one of its references. Make sure the parent tax rate (the combined tax rate) ' +\n            'is saved before adding the sub tax rates' unless (combined_tax_rate.present? && sub_tax_rate.present?)\n      raise 'Tax Rate not permited. Invalid scope!' unless combined_tax_rate.scope_id == sub_tax_rate.scope_id\n    end\n\n    def combined_and_sub_tax_equality\n      return if sub_tax_rate_id.nil?\n      return if combined_tax_rate_id.nil?\n      self.errors.add(:combined_tax_rate, :cant_be_equal_to_sub_tax_rate) if self.combined_tax_rate_id == self.sub_tax_rate_id\n    end\n  end\nend\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"id":"0","maintainHistory":false,"markersById":{"2":{"range":{"start":{"row":29,"column":0},"end":{"row":29,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":false,"invalidate":"inside"},"18":{"range":{"start":{"row":1,"column":0},"end":{"row":1,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"19":{"range":{"start":{"row":10,"column":32},"end":{"row":10,"column":46}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"20":{"range":{"start":{"row":10,"column":49},"end":{"row":10,"column":58}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"21":{"range":{"start":{"row":15,"column":4},"end":{"row":15,"column":11}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"22":{"range":{"start":{"row":17,"column":119},"end":{"row":17,"column":120}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"23":{"range":{"start":{"row":18,"column":62},"end":{"row":18,"column":115}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"24":{"range":{"start":{"row":25,"column":6},"end":{"row":25,"column":17}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"25":{"range":{"start":{"row":25,"column":77},"end":{"row":25,"column":102}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"26":{"range":{"start":{"row":25,"column":106},"end":{"row":25,"column":126}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"27":{"range":{"start":{"row":25,"column":120},"end":{"row":25,"column":126}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"}},"version":2},"1":{"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"id":"2","maintainHistory":true,"markersById":{"1":{"range":{"start":{"row":29,"column":0},"end":{"row":29,"column":0}},"properties":{"type":"selection","goalScreenRange":null,"autoscroll":false},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2},"4":{"id":"4","maintainHistory":false,"markersById":{},"version":2}},"nextMarkerLayerId":5,"history":{"version":3,"nextCheckpointId":5,"undoStack":[{"type":"group-start","snapshot":{"2":{"1":{"range":[[0,0],[29,0]],"properties":{"type":"selection","goalScreenRange":null,"autoscroll":false},"reversed":false,"tailed":true,"valid":true,"invalidate":"never"}}}},{"type":"change","content":{"oldRange":[[0,0],[29,0]],"newRange":[[0,0],[43,0]],"oldText":"module CoreAccounting::Taxes::Models\n\n  # This class is responsible for knowing the tax rates that a combined tax is made up with\n  class TaxRateAssociation < ActiveRecord::Base\n    belongs_to :combined_tax_rate, class_name: 'CoreAccounting::Taxes::Models::TaxRate'\n    belongs_to :sub_tax_rate, class_name: 'CoreAccounting::Taxes::Models::TaxRate'\n\n    before_save :validate_sub_tax_rates\n    accepts_nested_attributes_for :sub_tax_rate\n\n    validates :sub_tax_rate_id, :uniqueness => { :scope => :combined_tax_rate_id }\n    validate :combined_and_sub_tax_equality\n\n    attr_accessible :sub_tax_rate_attributes, :name, :code, :percentage, :sub_tax_rate_id\n\n    private\n    def validate_sub_tax_rates\n      raise 'The association is missing one of its references. Make sure the parent tax rate (the combined tax rate) ' +\n            'is saved before adding the sub tax rates' unless (combined_tax_rate.present? && sub_tax_rate.present?)\n      raise 'Tax Rate not permited. Invalid scope!' unless combined_tax_rate.scope_id == sub_tax_rate.scope_id\n    end\n\n    def combined_and_sub_tax_equality\n      return if sub_tax_rate_id.nil?\n      return if combined_tax_rate_id.nil?\n      self.errors.add(:combined_tax_rate, :cant_be_equal_to_sub_tax_rate) if self.combined_tax_rate_id == self.sub_tax_rate_id\n    end\n  end\nend\n","newText":"module CoreAccounting::Taxes::Models\n  # This class is responsible for knowing the tax rates that a combined tax is made up with\n  class TaxRateAssociation < ActiveRecord::Base\n    belongs_to :combined_tax_rate, class_name: 'CoreAccounting::Taxes::Models::TaxRate'\n    belongs_to :sub_tax_rate, class_name: 'CoreAccounting::Taxes::Models::TaxRate'\n\n    before_save :validate_sub_tax_rates\n    accepts_nested_attributes_for :sub_tax_rate\n\n    validates :sub_tax_rate_id, uniqueness: { scope: :combined_tax_rate_id }\n    validate :combined_and_sub_tax_equality\n\n    attr_accessible :sub_tax_rate_attributes, :name, :code, :percentage, :sub_tax_rate_id\n\n    private\n\n    def validate_sub_tax_rates\n      validate_presence_of_tax_rates\n      validate_scope_ids\n    end\n\n    def combined_and_sub_tax_equality\n      return if sub_tax_rate_id.nil?\n      return if combined_tax_rate_id.nil?\n      errors.add(:combined_tax_rate, :cant_be_equal_to_sub_tax_rate) if combined_tax_rate_id == sub_tax_rate_id\n    end\n\n    def validate_presence_of_tax_rates\n      raise 'The association is missing one of its references. Make sure the parent tax rate (the combined tax rate) '\\\n            'is saved before adding the sub tax rates' unless combined_tax_rate.present? && sub_tax_rate.present?\n    end\n\n    def validate_scope_ids\n      cmb_scp_id = combined_tax_rate.scope_id\n      sub_scp_id = sub_tax_rate.scope_id\n\n      if cmb_scp_id != sub_scp_id\n        raise 'Tax Rate not permited. '\\\n              \"Invalid scope! combined scope_id #{cmb_scp_id} should tax rate scope_id #{sub_scp_id}\"\n      end\n    end\n  end\nend\n"}},{"type":"change","content":{"oldRange":[[0,0],[0,0]],"newRange":[[0,0],[0,0]],"oldText":"","newText":""}},{"type":"group-end","snapshot":{"2":{"1":{"range":[[43,0],[43,0]],"properties":{"type":"selection","goalScreenRange":null,"autoscroll":false},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}}},{"type":"group-start","snapshot":{"2":{"1":{"range":[[43,0],[43,0]],"properties":{"type":"selection","goalScreenRange":null,"autoscroll":false},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}}},{"type":"change","content":{"oldRange":[[1,0],[1,0]],"newRange":[[1,0],[2,0]],"oldText":"","newText":"\n"}},{"type":"change","content":{"oldRange":[[10,0],[10,0]],"newRange":[[10,0],[11,0]],"oldText":"","newText":"    validates :sub_tax_rate_id, :uniqueness => { :scope => :combined_tax_rate_id }\n"}},{"type":"change","content":{"oldRange":[[11,0],[12,0]],"newRange":[[11,0],[11,0]],"oldText":"    validates :sub_tax_rate_id, uniqueness: { scope: :combined_tax_rate_id }\n","newText":""}},{"type":"change","content":{"oldRange":[[16,0],[17,0]],"newRange":[[16,0],[16,0]],"oldText":"\n","newText":""}},{"type":"change","content":{"oldRange":[[17,0],[17,0]],"newRange":[[17,0],[20,0]],"oldText":"","newText":"      raise 'The association is missing one of its references. Make sure the parent tax rate (the combined tax rate) ' +\n            'is saved before adding the sub tax rates' unless (combined_tax_rate.present? && sub_tax_rate.present?)\n      raise 'Tax Rate not permited. Invalid scope!' unless combined_tax_rate.scope_id == sub_tax_rate.scope_id\n"}},{"type":"change","content":{"oldRange":[[20,0],[22,0]],"newRange":[[20,0],[20,0]],"oldText":"      validate_presence_of_tax_rates\n      validate_scope_ids\n","newText":""}},{"type":"change","content":{"oldRange":[[25,0],[25,0]],"newRange":[[25,0],[26,0]],"oldText":"","newText":"      self.errors.add(:combined_tax_rate, :cant_be_equal_to_sub_tax_rate) if self.combined_tax_rate_id == self.sub_tax_rate_id\n"}},{"type":"change","content":{"oldRange":[[26,0],[27,0]],"newRange":[[26,0],[26,0]],"oldText":"      errors.add(:combined_tax_rate, :cant_be_equal_to_sub_tax_rate) if combined_tax_rate_id == sub_tax_rate_id\n","newText":""}},{"type":"change","content":{"oldRange":[[27,0],[42,0]],"newRange":[[27,0],[27,0]],"oldText":"\n    def validate_presence_of_tax_rates\n      raise 'The association is missing one of its references. Make sure the parent tax rate (the combined tax rate) '\\\n            'is saved before adding the sub tax rates' unless combined_tax_rate.present? && sub_tax_rate.present?\n    end\n\n    def validate_scope_ids\n      cmb_scp_id = combined_tax_rate.scope_id\n      sub_scp_id = sub_tax_rate.scope_id\n\n      if cmb_scp_id != sub_scp_id\n        raise 'Tax Rate not permited. '\\\n              \"Invalid scope! combined scope_id #{cmb_scp_id} should tax rate scope_id #{sub_scp_id}\"\n      end\n    end\n","newText":""}},{"type":"group-end","snapshot":{"2":{"1":{"range":[[29,0],[29,0]],"properties":{"type":"selection","goalScreenRange":null,"autoscroll":false},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}}}],"redoStack":[]},"encoding":"utf8","filePath":"/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/core_accounting/taxes/models/tax_rate_association.rb","digestWhenLastPersisted":"ab44adf07a6d626e8339e544dfdf432853e2faea","preferredLineEnding":null,"nextMarkerId":28,"deserializer":"TextBuffer","version":5}]},"workspace":{"deserializer":"Workspace","paneContainer":{"deserializer":"PaneContainer","version":1,"root":{"deserializer":"Pane","id":52,"items":[{"deserializer":"TextEditor","id":89,"softTabs":true,"firstVisibleScreenRow":5,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":90,"softWrapped":false,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/core_accounting/taxes/models/tax_rate_association.rb","bufferId":"cc42eb8ce4a554c7463d4ce5e13087c8","largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"}],"activeItemURI":"/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/core_accounting/taxes/models/tax_rate_association.rb","focused":true,"flexScale":1},"activePaneId":52},"packagesWithActiveGrammars":["language-ruby","language-hyperlink","language-todo"],"destroyedItemURIs":["/Users/victor.martins/Temp/sage_one_advanced/host_app/db/schema.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/spec/dummy/db/schema.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/Gemfile","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/fuji_invoicing/concerns/artefact_number_formatting.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/spec/lib/support/concerns/pdf_email_spec.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/support/concerns/pdf_email.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/spec/lib/support/concerns/pdf_email_spec.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/spec/lib/support/concerns/isolate_namespace_spec.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/spec/dummy/db/structure.sql","/Users/victor.martins/Temp/sage_one_advanced/host_app/db/structure.sql","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/spec/lib/core_accounting/taxes/models/tax_submission_frequency_type_spec.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/core_accounting/taxes/models/tax_submission_frequency_type.rb","/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/app/models/fuji_core_accounting/tax_submission_frequency_type.rb"]},"packageStates":{"fuzzy-finder":{"/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/core_accounting/taxes/models/tax_rate_association.rb":1461067370481},"keybinding-resolver":{},"metrics":{"sessionLength":78887847},"tabs":[{}],"tree-view":{"directoryExpansionStates":{"/Users/victor.martins/Temp/sage_one_advanced":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},"advanced_uk":{"isExpanded":true,"entries":{".bundle":{"isExpanded":false,"entries":{}},".yardoc":{"isExpanded":false,"entries":{}},"app":{"isExpanded":false,"entries":{}},"bin":{"isExpanded":false,"entries":{}},"config":{"isExpanded":false,"entries":{}},"coverage":{"isExpanded":false,"entries":{}},"db":{"isExpanded":false,"entries":{}},"lib":{"isExpanded":true,"entries":{"accountant_handlers":{"isExpanded":false,"entries":{}},"addresses":{"isExpanded":false,"entries":{}},"advanced_uk":{"isExpanded":false,"entries":{}},"assets":{"isExpanded":false,"entries":{}},"contacts":{"isExpanded":false,"entries":{}},"core_accounting":{"isExpanded":false,"entries":{}},"currencies":{"isExpanded":false,"entries":{}},"exceptions":{"isExpanded":false,"entries":{}},"feedback":{"isExpanded":false,"entries":{}},"fixers":{"isExpanded":false,"entries":{}},"fuji_banking":{"isExpanded":false,"entries":{}},"fuji_invoicing":{"isExpanded":false,"entries":{}},"fuji_reporting":{"isExpanded":false,"entries":{}},"online_payment":{"isExpanded":false,"entries":{}},"promotion":{"isExpanded":false,"entries":{}},"reporting":{"isExpanded":false,"entries":{}},"services":{"isExpanded":false,"entries":{}},"sop_settings":{"isExpanded":false,"entries":{}},"support":{"isExpanded":true,"entries":{"concerns":{"isExpanded":true,"entries":{}},"csv":{"isExpanded":false,"entries":{}},"exception_handlers":{"isExpanded":false,"entries":{}},"extensions":{"isExpanded":false,"entries":{}},"helpers":{"isExpanded":false,"entries":{}},"pdf_server":{"isExpanded":false,"entries":{}},"resource_providers":{"isExpanded":false,"entries":{}},"responders":{"isExpanded":false,"entries":{}}}},"tasks":{"isExpanded":false,"entries":{}}}},"script":{"isExpanded":false,"entries":{}},"spec":{"isExpanded":true,"entries":{"accountant_handlers":{"isExpanded":false,"entries":{}},"allocations":{"isExpanded":false,"entries":{}},"bank_feeds":{"isExpanded":false,"entries":{}},"bpath":{"isExpanded":false,"entries":{}},"controllers":{"isExpanded":false,"entries":{}},"dummy":{"isExpanded":false,"entries":{}},"exception_handlers":{"isExpanded":false,"entries":{}},"extensions":{"isExpanded":false,"entries":{}},"factories":{"isExpanded":false,"entries":{}},"features":{"isExpanded":false,"entries":{}},"fixers":{"isExpanded":false,"entries":{}},"grid_definitions":{"isExpanded":false,"entries":{}},"helpers":{"isExpanded":false,"entries":{}},"javascripts":{"isExpanded":false,"entries":{}},"jobs":{"isExpanded":false,"entries":{}},"lib":{"isExpanded":true,"entries":{"addresses":{"isExpanded":false,"entries":{}},"advanced_uk":{"isExpanded":false,"entries":{}},"banking":{"isExpanded":false,"entries":{}},"contacts":{"isExpanded":false,"entries":{}},"core_accounting":{"isExpanded":false,"entries":{}},"currencies":{"isExpanded":false,"entries":{}},"feedback":{"isExpanded":false,"entries":{}},"fuji_banking":{"isExpanded":false,"entries":{}},"fuji_invoicing":{"isExpanded":false,"entries":{}},"fuji_reporting":{"isExpanded":false,"entries":{}},"online_payment":{"isExpanded":false,"entries":{}},"online_vat_submission":{"isExpanded":false,"entries":{}},"reporting":{"isExpanded":false,"entries":{}},"services":{"isExpanded":false,"entries":{}},"sop_settings":{"isExpanded":false,"entries":{}},"support":{"isExpanded":true,"entries":{"concerns":{"isExpanded":true,"entries":{}},"csv":{"isExpanded":false,"entries":{}},"helpers":{"isExpanded":false,"entries":{}},"resource_providers":{"isExpanded":false,"entries":{}},"responders":{"isExpanded":false,"entries":{}}}},"update_handlers":{"isExpanded":false,"entries":{}},"validators":{"isExpanded":false,"entries":{}}}},"mailers":{"isExpanded":false,"entries":{}},"mixins":{"isExpanded":false,"entries":{}},"models":{"isExpanded":false,"entries":{}},"my_sage_one":{"isExpanded":false,"entries":{}},"mysageone_client":{"isExpanded":false,"entries":{}},"presenters":{"isExpanded":false,"entries":{}},"promotion":{"isExpanded":false,"entries":{}},"reports":{"isExpanded":false,"entries":{}},"requests":{"isExpanded":false,"entries":{}},"resolvers":{"isExpanded":false,"entries":{}},"support":{"isExpanded":false,"entries":{}},"transactions":{"isExpanded":false,"entries":{}},"uploaders":{"isExpanded":false,"entries":{}},"views":{"isExpanded":false,"entries":{}},"widgets":{"isExpanded":false,"entries":{}}}}}},"change_log":{"isExpanded":false,"entries":{}},"ci":{"isExpanded":false,"entries":{}},"country_config":{"isExpanded":false,"entries":{}},"dev_keys":{"isExpanded":false,"entries":{}},"guides":{"isExpanded":false,"entries":{}},"host_app":{"isExpanded":true,"entries":{".yardoc":{"isExpanded":false,"entries":{}},"app":{"isExpanded":false,"entries":{}},"bin":{"isExpanded":false,"entries":{}},"config":{"isExpanded":false,"entries":{}},"coverage":{"isExpanded":false,"entries":{}},"db":{"isExpanded":true,"entries":{"archived_migrations":{"isExpanded":false,"entries":{}},"migrate":{"isExpanded":false,"entries":{}},"stored_procedures":{"isExpanded":false,"entries":{}}}},"demo_data":{"isExpanded":false,"entries":{}},"lib":{"isExpanded":false,"entries":{}},"log":{"isExpanded":false,"entries":{}},"public":{"isExpanded":false,"entries":{}},"script":{"isExpanded":false,"entries":{}},"spec":{"isExpanded":false,"entries":{}},"tmp":{"isExpanded":false,"entries":{}}}},"sage_one_gac_test":{"isExpanded":false,"entries":{}},"script":{"isExpanded":false,"entries":{}},"ui":{"isExpanded":false,"entries":{}}}}},"selectedPath":"/Users/victor.martins/Temp/sage_one_advanced/advanced_uk/lib/core_accounting","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":320},"linter":{"scope":"File"},"find-and-replace":{"findOptions":{"findPattern":"20160323102726","replacePattern":"","pathsPattern":"","useRegex":false,"wholeWord":false,"caseSensitive":false,"inCurrentSelection":false},"findHistory":["20160323102726"],"replaceHistory":[],"pathsHistory":[]}},"fullScreen":false}